<app-navbar></app-navbar>

<div class="loan-application-container">
  <h2>Loan Application</h2>

  <!-- Prediction Result -->
  <div *ngIf="predictionResult" class="prediction-result" [ngClass]="predictionResult.riskLevel">
    <h3>Prediction Results</h3>
    <div class="result-card">
      <p><strong>Default Probability:</strong> {{ predictionResult.defaultProbability * 100 | number:'1.2-2' }}%</p>
      <p><strong>Risk Level:</strong> {{ predictionResult.riskLevel }}</p>
      <p><strong>Confidence:</strong> {{ predictionResult.confidence * 100 | number:'1.2-2' }}%</p>
      <p><strong>Model:</strong> {{ predictionResult.model }}</p>
    </div>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Loan Application Form -->
  <form [formGroup]="loanForm" (ngSubmit)="onSubmit()">
    
    <!-- Applicant Information Section -->
    <h3>Applicant Information</h3>
    
    <div class="form-row">
      <div class="form-group">
        <label for="age">Age *</label>
        <input 
          type="number" 
          id="age"
          formControlName="age" 
          placeholder="25">
        <div class="error" *ngIf="loanForm.get('age')?.invalid && loanForm.get('age')?.touched">
          Age is required (18-100)
        </div>
      </div>

      <div class="form-group">
        <label for="income">Annual Income ($) *</label>
        <input 
          type="number" 
          id="income"
          formControlName="income" 
          placeholder="50000">
        <div class="error" *ngIf="loanForm.get('income')?.invalid && loanForm.get('income')?.touched">
          Income is required
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="homeOwnership">Home Ownership *</label>
        <select id="homeOwnership" formControlName="homeOwnership">
          <option value="">Select...</option>
          <option *ngFor="let option of homeOwnershipOptions" [value]="option">
            {{ option }}
          </option>
        </select>
        <div class="error" *ngIf="loanForm.get('homeOwnership')?.invalid && loanForm.get('homeOwnership')?.touched">
          Home ownership is required
        </div>
      </div>

      <div class="form-group">
        <label for="employmentStatus">Employment Status *</label>
        <select id="employmentStatus" formControlName="employmentStatus">
          <option value="">Select...</option>
          <option *ngFor="let option of employmentStatusOptions" [value]="option">
            {{ option }}
          </option>
        </select>
        <div class="error" *ngIf="loanForm.get('employmentStatus')?.invalid && loanForm.get('employmentStatus')?.touched">
          Employment status is required
        </div>
      </div>
    </div>

    <!-- Loan Details Section -->
    <h3>Loan Details</h3>
    
    <div class="form-row">
      <div class="form-group">
        <label for="loanAmount">Loan Amount ($) *</label>
        <input 
          type="number" 
          id="loanAmount"
          formControlName="loanAmount" 
          placeholder="10000">
        <div class="error" *ngIf="loanForm.get('loanAmount')?.invalid && loanForm.get('loanAmount')?.touched">
          Loan amount is required (min $1000)
        </div>
      </div>

      <div class="form-group">
        <label for="loanPurpose">Loan Purpose *</label>
        <select id="loanPurpose" formControlName="loanPurpose">
          <option value="">Select...</option>
          <option *ngFor="let purpose of loanPurposeOptions" [value]="purpose">
            {{ purpose.replace('_', ' ') }}
          </option>
        </select>
        <div class="error" *ngIf="loanForm.get('loanPurpose')?.invalid && loanForm.get('loanPurpose')?.touched">
          Loan purpose is required
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="interestRate">Interest Rate (%) *</label>
        <input 
          type="number" 
          step="0.01" 
          id="interestRate"
          formControlName="interestRate" 
          placeholder="5.5">
        <div class="error" *ngIf="loanForm.get('interestRate')?.invalid && loanForm.get('interestRate')?.touched">
          Interest rate is required (0-30%)
        </div>
      </div>

      <div class="form-group">
        <label for="loanTerm">Loan Term (months) *</label>
        <input 
          type="number" 
          id="loanTerm"
          formControlName="loanTerm" 
          placeholder="36">
        <div class="error" *ngIf="loanForm.get('loanTerm')?.invalid && loanForm.get('loanTerm')?.touched">
          Loan term is required (12-60 months)
        </div>
      </div>
    </div>

    <!-- Credit Information Section -->
    <h3>Credit Information</h3>
    
    <div class="form-row">
      <div class="form-group">
        <label for="creditScore">Credit Score *</label>
        <input 
          type="number" 
          id="creditScore"
          formControlName="creditScore" 
          placeholder="700">
        <div class="error" *ngIf="loanForm.get('creditScore')?.invalid && loanForm.get('creditScore')?.touched">
          Credit score is required (300-850)
        </div>
      </div>

      <div class="form-group">
        <label for="debtToIncomeRatio">Debt-to-Income Ratio (%) *</label>
        <input 
          type="number" 
          step="0.01" 
          id="debtToIncomeRatio"
          formControlName="debtToIncomeRatio" 
          placeholder="25">
        <div class="error" *ngIf="loanForm.get('debtToIncomeRatio')?.invalid && loanForm.get('debtToIncomeRatio')?.touched">
          Debt-to-income ratio is required
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="button-group">
      <button 
        type="submit" 
        [disabled]="loading || loanForm.invalid" 
        class="submit-btn">
        {{ loading ? 'Processing...' : 'Submit Application' }}
      </button>
      
      <button 
        type="button" 
        (click)="resetForm()" 
        class="reset-btn"
        [disabled]="loading">
        Reset
      </button>
      
      <button 
        type="button" 
        (click)="viewApplications()" 
        class="history-btn"
        [disabled]="loading">
        View My Applications
      </button>
    </div>
  </form>
</div>